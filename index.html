<html>
<head>  
</head>
    
<style>

        html, body {
       width: 100%;
       height: 100%;
       margin: 0px;
    }
    
    #mijnCanvasje{
        border: 5px solid black;
        background-color: black;
    }
    
</style>
<body onload='init()'>
<canvas id="mijnCanvasje"
</canvas>
<div id="balkLinks"></div>
<div id="balkRechts"></div>

</div>
<style>
html, body {
   width: 100%;
   height: 100%;
   margin: 0px;
}
#balkLinks, #balkRechts{
   -webkit-transition: all;
   transition: all;
   position:absolute;
   background: black;
}

</style>

<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="server.js"></script>
<script>
   if ( !window.requestAnimationFrame ) { // Deze methode vertelt de browser dat je een animatie wilt uitvoeren
       window.requestAnimationFrame = ( function() {
           return window.webkitRequestAnimationFrame ||
           window.mozRequestAnimationFrame || //voor Firefox
           window.oRequestAnimationFrame || //voor Opera
           window.msRequestAnimationFrame || //voor internet explorer
           
           function( /* function FrameRequestCallback */ callback, /* DOMElement Element */ element ) {
               window.setTimeout( callback, 1000 / 60 );
           }; 
       } )(); 
   }
    
    var socket = io();
    
    var canvasWidth = 1000;
    var canvasHeight = 600;
    var theContext = startDrawing("mijnCanvasje")
    window.addEventListener('resize', resizeCanvas, false)
    function resizeCanvas() {
        mijnCanvasje.width = canvasWidth
        mijnCanvasje.height = canvasHeight
    }
    resizeCanvas();

 
    function startDrawing(canvasId) {
      var canvasElement = document.getElementById(canvasId);
      var drawingContext = canvasElement.getContext("2d");
      return drawingContext;
    }
   
    var theContext = startDrawing("mijnCanvasje")
    var x = 200;  // houdt de veranderende horizontale positie bij
    var y = 300;  // houd de veranderende verticale positie bij
    var frameTeller = 0;
    var stapX = 0//(canvasWidth/100)*1;    // De X-as snelheid (in frames) per seconde
    var stapY = 0//(canvasWidth/100)*1;    // De Y-as snelheid (in frames) per seconde
    var straal = 10;  // De straal van de bal
    var hoogtePlatform = 90;   // De hoogte van de platform (in pixels)
    // var platform1X = (canvasWidth/100)*5    // Beginpositie X-as platform links
    var platform1Y    // Beginpositie Y-as (niet ingesteld)
    var onderkantPlatform1
    var bovenkantPlatform1
    var platform2X    // Beginpositie X-as platform rechts
    var platform2Y     // Beginpositie Y-as platform rechts
    var onderkantPlatform2
    var bovenkantPlatform2
    //-------------------------------------------------------------------------------//
    var breedtePlatform = 150;   // De breedte van de platform (in pixels)
    
    function drawPlatform1(x, y) {   // Tekent het platform links
        theContext.beginPath();
        theContext.rect(platform1X, platform1Y, 10, hoogtePlatform)
        theContext.closePath();
        theContext.stroke();
    }
    function drawPlatform2(x, y) {   // Tekent het platform rechts
        theContext.beginPath();
        theContext.rect(platform2X, platform2Y, 10, hoogtePlatform)
        theContext.closePath();
        theContext.stroke();
    }
    
    
    
    function update(){
        balkLinks.positie.y += (balkLinks.snelheid.y / 2);    //Verplaatsing van het linker platform
        balkRechts.positie.y += (balkRechts.snelheid.y / 2);  //Verplaatsing van het rechter platform
        //-------------------------------------------------------------------------------//
        balkBoven.positie.x += (balkBoven.snelheid.x / 2);  //Verplaatsing van het bovenste platform
        balkOnder.positie.x += (balkOnder.snelheid.x / 2);  //Verplaatsing van het onderste platform
        //-------------------------------------------------------------------------------//
        if (balkLinks.positie.y < 0 && balkLinks.snelheid.y < 0){   //bovenkant platform links
            balkLinks.positie.y = 0;
        }      
        if (balkLinks.positie.y > canvasHeight - hoogtePlatform && balkLinks.snelheid.y > 0){  //onderkant platform links
            balkLinks.positie.y = canvasHeight - hoogtePlatform;
        }
        if (balkRechts.positie.y < 0 && balkRechts.snelheid.y < 0){ //bovenkant platform rechts
            balkRechts.positie.y = 0;
        }
        if (balkRechts.positie.y > canvasHeight - hoogtePlatform && balkRechts.snelheid.y > 0){ //onderkant platform rechts
            balkRechts.positie.y = canvasHeight - hoogtePlatform;
        }

        requestAnimationFrame( update );    //KEEP ANIMATING
    }
    
    function init(data){
        balkLinks = document.getElementById("balkLinks");  //Creëer variable van de linker balk
        balkRechts = document.getElementById("balkRechts");   //Creëer variable van de rechter balk
     
        w = canvasWidth;
        h = canvasHeight;
        
        balkLinks.style.left = 50 +"px";    //Positie balkLinks
        balkLinks.style.top = 300 +"px";
        balkLinks.style.height = hoogtePlatform+"px";
        balkLinks.snelheid = {x:0,y:0}
        balkLinks.positie = {x:0,y:300}
   
        balkRechts.style.left = 950+"px"; //positie balkRechts
        balkRechts.style.top = 300+"px";
        balkRechts.style.height = hoogtePlatform+"px";
        balkRechts.snelheid = {x:0,y:0}
        balkRechts.positie = {x:0,y:300}
        
        if(window.DeviceOrientationEvent){
            window.addEventListener("deviceorientation", function(event){
                balkLinks.snelheid.y = Math.round(event.beta);
                balkLinks.snelheid.x = Math.round(event.gamma);
                balkRechts.snelheid.y = Math.round(event.beta); //beta is je mobiel kantelen via de lengte.
                balkRechts.snelheid.x = Math.round(event.gamma); 
                console.log(event);
                socket.emit('orientation', event)
            });
        };
        
        update();
    }
  
    
    socket.on('canvas', function(platformArr){
       
        theContext.clearRect(0,0,canvasWidth,canvasHeight); 
        
        for(var i=0;i<platformArr.length;i++){
            var thisPlatform=platformArr[i];
            drawPlatform(thisPlatform);
            console.log('>>>>', i, thisPlatform);
        }
    });
    
</script>
</body>
</html>